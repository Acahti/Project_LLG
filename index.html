<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PROJECT: LLG v8.0</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css?v=8.0">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>
    <header>
        <div class="header-left" onclick="openTitleModal()">
            <span id="header-job-title" class="header-job-title">&lt;칭호&gt;</span>
            <div style="display:flex; align-items:center; gap:5px;">
                <span class="material-icons-round job-icon" style="font-size:14px;">verified</span> 
                <span id="header-job-name" class="header-job-name">직업</span>
            </div>
        </div>
        <div class="header-right">
            <div style="display:flex; align-items:center; gap:5px;">
                <span class="material-icons-round gold-icon" style="font-size:14px;">monetization_on</span> 
                <span id="ui-gold" style="font-size:10px; color:#FFD700;">0 G</span>
            </div>
            <button class="icon-btn" onclick="openSettingsModal()">
                <span class="material-icons-round">settings</span>
            </button>
        </div>
    </header>

    <main>
        <section id="tab-character" class="tab-screen active">
            <div class="chart-container">
                <canvas id="stat-radar" width="300" height="300"></canvas>
                <div class="chart-level" id="chart-total-level">Lv.0</div>
            </div>
            <div class="card header-card">
                <span>능력치 & 스킬</span>
                <div style="display:flex; gap:5px;">
                    <button class="btn-sm" style="background:#333; color:#888;" onclick="openRestoreSkillMode()">🗑️ 보관함</button>
                    <button class="btn-sm" onclick="openSkillCreateModal()">+ 스킬 생성</button>
                </div>
            </div>
            <div id="stats-list" class="stats-accordion"></div>
        </section>

        <section id="tab-quest" class="tab-screen">
            <div class="card header-card">
                <span>의뢰 게시판</span>
                <button class="btn-sm" onclick="openQuestManager()">+ 의뢰 관리</button>
            </div>
            <div id="quest-container"></div>
            <div id="empty-quest-msg" style="text-align:center; color:#555; font-size:10px; margin-top:20px; display:none;">
                등록된 의뢰가 없습니다.
            </div>
        </section>

        <section id="tab-battle" class="tab-screen">
            <div id="phaser-root"></div>
            <div class="battle-ui">
                <h3 id="battle-quest-name" style="color:var(--accent)">-</h3>
                <h1 id="battle-timer">00:00:00</h1>
                <p id="battle-earning">대기중...</p>
                <button id="btn-stop" class="btn-danger">완료 (보상 수령)</button>
            </div>
        </section>

        <section id="tab-inventory" class="tab-screen">
            <div class="card header-card">
                <span>보관함</span>
                <button class="btn-sm" onclick="openCreateItemModal()">+ 기록 추가</button>
            </div>
            <div id="inventory-grid" class="inv-grid"></div>
        </section>

        <section id="tab-shop" class="tab-screen">
            <div class="card header-card">
                <span>환전소</span>
                <button class="btn-sm" onclick="openCreateShopItemModal()">+ 상품 추가</button>
            </div>
            <div id="shop-container"></div>
        </section>
    </main>

    <nav>
        <a class="nav-btn active" data-target="character"><span class="material-icons-round">person</span><span class="nav-label">내정보</span></a>
        <a class="nav-btn" data-target="quest"><span class="material-icons-round">assignment_late</span><span class="nav-label">의뢰</span></a>
        <a class="nav-btn" data-target="battle"><span class="material-icons-round">flash_on</span><span class="nav-label">전투</span></a>
        <a class="nav-btn" data-target="inventory"><span class="material-icons-round">inventory_2</span><span class="nav-label">보관함</span></a>
        <a class="nav-btn" data-target="shop"><span class="material-icons-round">storefront</span><span class="nav-label">상점</span></a>
    </nav>

    <div id="toast-container"></div>

    <div id="modal-confirm" class="modal">
        <div class="modal-content">
            <h3>확인</h3>
            <p id="confirm-msg" style="text-align:center; margin:20px 0;">내용</p>
            <div style="display:flex; gap:10px;">
                <button id="btn-confirm-yes" class="btn-primary">확인</button>
                <button onclick="closeConfirmModal()" class="btn-danger" style="background:#555; border-bottom-color:#333;">취소</button>
            </div>
        </div>
    </div>

    <div id="modal-create-skill" class="modal">
        <div class="modal-content">
            <h3>스킬 습득</h3>
            <label class="input-label">1. 핵심 스탯</label>
            <div id="core-select-group" class="chip-group"></div>
            <label class="input-label">2. 마스터리</label>
            <select id="new-mastery-select" class="input-dark" onchange="checkMasteryInput()"></select>
            <input type="text" id="new-mastery-input" class="input-dark" style="display:none;" placeholder="예: 언어능력">
            <label class="input-label">3. 스킬 이름</label>
            <input type="text" id="new-skill-name" class="input-dark" placeholder="예: 문해력">
            <button onclick="createSkillAction()" class="btn-primary" style="margin-top:15px;">생성</button>
            <button onclick="closeModal('modal-create-skill')" class="btn-text">취소</button>
        </div>
    </div>

    <div id="modal-edit-skill" class="modal">
        <div class="modal-content">
            <h3>스킬 수정</h3>
            <label class="input-label">스킬 이름</label>
            <input type="text" id="edit-skill-name" class="input-dark">
            <label class="input-label">소속 마스터리 변경</label>
            <select id="edit-skill-mastery" class="input-dark"></select>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button onclick="saveSkillEdit()" class="btn-primary">저장</button>
                <button onclick="closeModal('modal-edit-skill')" class="btn-text">취소</button>
            </div>
            <div class="danger-zone">
                <button onclick="deleteSkillEdit()" class="btn-danger" style="background:#333; color:#aaa;">이 스킬 삭제 (보관)</button>
            </div>
        </div>
    </div>

    <div id="modal-edit-mastery" class="modal">
        <div class="modal-content">
            <h3>마스터리 수정</h3>
            <label class="input-label">마스터리 이름</label>
            <input type="text" id="edit-mastery-name" class="input-dark">
            <label class="input-label">핵심 스탯(Core) 변경</label>
            <select id="edit-mastery-core" class="input-dark"></select>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button onclick="saveMasteryEdit()" class="btn-primary">저장</button>
                <button onclick="closeModal('modal-edit-mastery')" class="btn-text">취소</button>
            </div>
            <div class="danger-zone">
                <button onclick="deleteMasteryEdit()" class="btn-danger">⚠️ 마스터리 전체 삭제</button>
            </div>
        </div>
    </div>

    <div id="modal-create-quest" class="modal">
        <div class="modal-content">
            <h3>의뢰 생성</h3>
            <label class="input-label">의뢰 이름</label>
            <input type="text" id="new-quest-name" class="input-dark" placeholder="예: 심리학 책 읽기">
            <label class="input-label">주 목표 (100% 성장)</label>
            <select id="quest-main-skill" class="input-dark"></select>
            <label class="input-label">보너스 목표 (20% 성장, 선택)</label>
            <select id="quest-sub-skill" class="input-dark"></select>
            <button onclick="createQuestAction()" class="btn-primary" style="margin-top:15px;">게시</button>
            <button onclick="closeModal('modal-create-quest')" class="btn-text">취소</button>
        </div>
    </div>

    <div id="modal-restore-skill" class="modal">
        <div class="modal-content">
            <h3>기억의 무덤</h3>
            <p class="modal-desc">삭제된 스킬들이 잠들어 있습니다.</p>
            <div id="deleted-skill-list" class="list-group"></div>
            <button onclick="closeModal('modal-restore-skill')" class="btn-text">닫기</button>
        </div>
    </div>

    <div id="modal-title" class="modal">
        <div class="modal-content">
            <h3>신분 변경</h3>
            <div class="tab-group"><button id="tab-btn-title" class="tab-btn active" onclick="switchTitleTab('title')">칭호</button><button id="tab-btn-job" class="tab-btn" onclick="switchTitleTab('job')">직업</button></div>
            <div id="title-list-container" class="list-group"></div>
            <button onclick="closeModal('modal-title')" class="btn-text">닫기</button>
        </div>
    </div>

    <div id="modal-edit-item" class="modal">
        <div class="modal-content">
            <h3>아이템 상세</h3>
            <label class="input-label">이름</label>
            <input type="text" id="edit-item-name" class="input-dark">
            <label class="input-label">설명</label>
            <input type="text" id="edit-item-desc" class="input-dark">
            <label class="input-label">아이콘</label>
            <input type="text" id="edit-item-icon" class="input-dark">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button onclick="saveItemEdit()" class="btn-primary">저장</button>
                <button onclick="closeModal('modal-edit-item')" class="btn-text">취소</button>
            </div>
            <div class="danger-zone">
                <button onclick="deleteItemEdit()" class="btn-danger">삭제 (버리기)</button>
            </div>
        </div>
    </div>

    <div id="modal-create-shop-item" class="modal">
        <div class="modal-content">
            <h3>상품 등록</h3>
            <label class="input-label">상품명</label><input type="text" id="new-shop-item-name" class="input-dark"><label class="input-label">가격</label><input type="number" id="new-shop-item-cost" class="input-dark"><button onclick="createShopItemAction()" class="btn-shop" style="margin-top:15px; color:#000;">등록</button><button onclick="closeModal('modal-create-shop-item')" class="btn-text">취소</button>
        </div>
    </div>

    <div id="modal-create-item" class="modal">
        <div class="modal-content">
            <h3>기록 추가</h3>
            <label class="input-label">이름</label><input type="text" id="new-item-name" class="input-dark"><label class="input-label">설명</label><input type="text" id="new-item-desc" class="input-dark"><label class="input-label">아이콘</label><input type="text" id="new-item-icon" class="input-dark" value="📕"><button onclick="createItemAction()" class="btn-primary" style="margin-top:15px;">기록</button><button onclick="closeModal('modal-create-item')" class="btn-text">취소</button>
        </div>
    </div>

    <div id="modal-skill-manager" class="modal" style="display:none;"></div>

    <div id="modal-settings" class="modal">
        <div class="modal-content">
            <h3>설정</h3>
            <button id="btn-export">💾 백업 저장</button>
            <button id="btn-import" style="margin-top:10px; background:#555;">📂 백업 로드</button>
            <button id="btn-reset" style="margin-top:10px; background:#882222;">⚠️ 초기화</button>
            <button onclick="closeModal('modal-settings')" class="btn-text">닫기</button>
            <input type="file" id="file-input" style="display: none;" accept=".json">
        </div>
    </div>

    <script>if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');</script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
